# Используем официальный образ Golang для сборки и запуска
FROM golang:1.21-alpine

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем go mod и go sum файлы
COPY go.mod go.sum ./

# Устанавливаем переменные окружения для Go
ENV CGO_ENABLED=0
ENV GOOS=linux

# Загружаем зависимости
RUN go mod download

# Копируем исходный код
COPY . .

# Собираем приложение
RUN go build -o main .

# Копируем статические файлы фронтенда (они уже в контейнере)
# frontend директория будет скопирована с помощью COPY . .

# Открываем порт
EXPOSE 3000

# Запускаем приложение
CMD ["./main"]